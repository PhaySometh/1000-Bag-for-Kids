# មូលនិធិ ១ ពាន់ កាបូប នៃស្នាមញញឹម

This is a small one-page campaign site built with Next.js and Tailwind CSS. It uses Supabase for storing the campaign state (current bags, goal, items, and last updated). The admin page allows quick updates using buttons or a manual value.

Features

- Mobile-first responsive UI with Khmer support
- Public one-page site with progress bar and campaign details
- Admin route at `/admin` with password-protected update API
- Uses Supabase for persistent storage; includes an in-memory/read fallback for local testing

Quickstart (Local)

1. Clone repository
2. Install dependencies:

```bash
npm install
```

3. Copy `.env.example` to `.env.local` and set variables (Supabase URL/keys or leave blank for local-only testing)

4. Run dev server

```bash
npm run dev
```

Supabase Setup

1. Create a Supabase project
2. Create a `campaign` table using SQL (or create from Studio):

```sql
create table campaign (
  id text primary key,
  title text,
  subtitle text,
  current_bags integer default 0,
  goal integer default 1000,
  donation_items jsonb,
  location_url text,
  qr_url text,
  school_name text,
  last_updated timestamptz
);

insert into campaign (id, title, subtitle, current_bags, goal, donation_items, last_updated) values (
  'default', 'មូលនិធិ១ពាន់កាបូបនៃស្នាមញញឹម', 'សម្រាប់ក្មេងៗភៀសសឹក', 0, 1000, '[]', now()
);
```

3. Get `SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, and `SUPABASE_SERVICE_ROLE_KEY` from Supabase. Add them to `.env.local` (see `.env.example`).

If you don't provide Supabase keys, the app will use a local JSON file at `data/campaign.json` for local development. This is only for ease of testing and does not provide persistent or shared storage for production.

Images (hero, QR codes, logos) are included in `public/images/` and are not stored in the database. This keeps the database focused on progress data only.

Khmer font (Niradei)

- The project includes `Niradei-Bold.ttf` in `public/fonts/`.
- The app registers the font via `@font-face` in `styles/globals.css`. Tailwind's `font-sans` is configured to prefer Niradei.
- This project prefers Niradei as the default app font where available. If a regular weight is not present, the Bold file may be used as a fallback for normal-weight rendering.
- If you want to override the bundled Niradei font, replace `public/fonts/Niradei-Bold.ttf`.
- For better performance, add a WOFF2 version: `public/fonts/Niradei-Bold.woff2` (recommended) and keep `Niradei-Bold.ttf` as fallback. A `preload` link is included in `pages/_document.tsx` to speed up first paint.
- If you don't have a converter, you can produce WOFF2 using: `npm i -D ttf2woff2` then `npx ttf2woff2 public/fonts/Niradei-Bold.ttf`.

Add a custom font (general steps)

- Place your font files into `public/fonts/` (WOFF2 recommended). For example: `public/fonts/MyCustom-Regular.woff2` and `public/fonts/MyCustom-Bold.woff2`.
- Add `@font-face` declarations into `styles/globals.css` or import using `next/font/local`.
- Map the font family name to a Tailwind `fontFamily` in `tailwind.config.cjs` like:

```js
// tailwind.config.cjs
module.exports = {
  theme: {
    extend: {
      fontFamily: {
        myCustom: ["MyCustom", "Inter", "ui-sans-serif"],
      },
    },
  },
};
```

- Use the new font in markup: `<div className="font-myCustom">Your text</div>` or apply globally by wrapping root element.

Using Next.js local font (Next 13+)

- For optimized loading and to get a `className` you can use directly, consider `next/font/local`:

```ts
// pages/_app.tsx
import localFont from "next/font/local";

const niradei = localFont({
  src: [
    { path: "/fonts/Niradei-Regular.woff2", weight: "400" },
    { path: "/fonts/Niradei-Bold.woff2", weight: "700" },
  ],
  display: "swap",
});

export default function MyApp({ Component, pageProps }) {
  return (
    <div className={niradei.className}>
      <Component {...pageProps} />
    </div>
  );
}
```

This will apply `niradei` on the whole app and also add a stable class name generated by Next.js that works well alongside Tailwind utility classes.

4. Set at least `ADMIN_PASSWORD` env var in `.env.local` to protect updates.

Deployment

- Host with Vercel or Netlify; provide environment variables in the host dashboard.

Security notes

- The admin page uses an environment-protected API to enforce a server-side check with `ADMIN_PASSWORD`. Do not share the service role key publicly.

Troubleshooting

- If you see `Unauthorized` when attempting to update from `/admin`:
  - Verify `ADMIN_PASSWORD` in `.env.local` matches the password you enter on the page.
  - Restart `npm run dev` after editing `.env.local` so changes are picked up by the server.
  - If using Supabase, confirm `SUPABASE_SERVICE_ROLE_KEY` & `NEXT_PUBLIC_SUPABASE_URL` are set correctly.
